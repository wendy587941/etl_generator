-- SQL for table: EDW_NCARD_ACCTINF_STAGE
/* TRANSFORM_DATA */

/* 1. Delete 目的表 Stage data_exch_date = '#排程啟動日#' */
DELETE FROM ${TARGET_SCHEMA}.${TARGET_TABLE} WHERE DATA_EXCH_DATE = TO_DATE('${BD_EXCH_DATE}', 'yyyy-MM-dd');

-- Trinity SQL Script
/* 2. 抽取 Prestage 同期別進行新增 */
INSERT INTO ${TARGET_SCHEMA}.${TARGET_TABLE}
(
BU,
ACCT_NBR,
PRODUCT,
CURRENCY,
ACCT_STATUS,
CUST_BU,
CUST_NBR,
CUST_ALT_FLAG,
CUST_ALT_DTE,
CUST_ALT_BU,
CUST_ALT_NBR,
CYCLE,
CYCLE_NEXT,
CYCLE_NEXT_DTE,
STMT_FLAG,
STMT_ACTION,
ACCT_GROUP,
OPEN_DTE,
COLL_DTE,
CHGOFF_DTE,
DORMANT_DTE,
CTL_CODE,
CTL_CODE_DTE,
CTL_CODE_REASON,
INT_WAIVE_DTE,
LC_WAIVE_DTE,
CASH_FEE_WAIVE_DTE,
MEMBER_FEE_WAIVE_DTE,
SERVICE_FEE_WAIVE_DTE,
USER_FEE_1_WAIVE_DTE,
USER_FEE_2_WAIVE_DTE,
USER_FEE_3_WAIVE_DTE,
USER_FEE_4_WAIVE_DTE,
USER_FEE_5_WAIVE_DTE,
USER_FEE_6_WAIVE_DTE,
DD1_BANK,
DD1_BANK_NBR,
DD1_START_DTE,
DD1_END_DTE,
DD1_METHOD,
DD1_ASSIGN_AMT,
DD1_ASSIGN_PCT,
DD_OWNER,
DD2_BANK_NBR,
DD2_START_DTE,
DD2_END_DTE,
ACCT_GROUP_REASON,
DD2_ASSIGN_AMT,
INT_RATE_VARIANCE,
DC_BANK,
DC_BANK_NBR,
DC_START_DTE,
DC_END_DTE,
MAX_DUE,
MAX_REVOLVING,
CLASS,
TEMP_CLASS,
TEMP_CLASS_START_DTE,
TEMP_CLASS_END_DTE,
CREDIT_SCORE,
ACCT_GROUP_NEXT,
ACCT_GROUP_NEXT_DTE,
COLM_START_DTE,
COLM_END_DTE,
COLM_END,
COLM_ACTION,
STOP_DELQ,
KK4_CLOSE_DTE,
FORCE_STOP_DTE,
USER_CHAR_1,
USER_CHAR_2,
USER_CHAR_3,
USER_CHAR_4,
USER_CHAR_5,
USER_DTE_1,
USER_DTE_2,
USER_DTE_3,
USER_DTE_4,
USER_DTE_5,
USER_AMT_1,
USER_AMT_2,
USER_AMT_3,
USER_AMT_4,
USER_AMT_5,
MNT_DT,
MNT_USER,
DATA_UPDATE_TIME,
DATA_EXCH_DATE
)
SELECT
BU,
ACCT_NBR,
PRODUCT,
CURRENCY,
ACCT_STATUS,
CUST_BU,
CUST_NBR,
CUST_ALT_FLAG,
CUST_ALT_DTE,
CUST_ALT_BU,
CUST_ALT_NBR,
CYCLE,
CYCLE_NEXT,
CYCLE_NEXT_DTE,
STMT_FLAG,
STMT_ACTION,
ACCT_GROUP,
OPEN_DTE,
COLL_DTE,
CHGOFF_DTE,
DORMANT_DTE,
CTL_CODE,
CTL_CODE_DTE,
CTL_CODE_REASON,
INT_WAIVE_DTE,
LC_WAIVE_DTE,
CASH_FEE_WAIVE_DTE,
MEMBER_FEE_WAIVE_DTE,
SERVICE_FEE_WAIVE_DTE,
USER_FEE_1_WAIVE_DTE,
USER_FEE_2_WAIVE_DTE,
USER_FEE_3_WAIVE_DTE,
USER_FEE_4_WAIVE_DTE,
USER_FEE_5_WAIVE_DTE,
USER_FEE_6_WAIVE_DTE,
DD1_BANK,
DD1_BANK_NBR,
DD1_START_DTE,
DD1_END_DTE,
DD1_METHOD,
DD1_ASSIGN_AMT,
DD1_ASSIGN_PCT,
DD_OWNER,
DD2_BANK_NBR,
DD2_START_DTE,
DD2_END_DTE,
ACCT_GROUP_REASON,
DD2_ASSIGN_AMT,
INT_RATE_VARIANCE,
DC_BANK,
DC_BANK_NBR,
DC_START_DTE,
DC_END_DTE,
MAX_DUE,
MAX_REVOLVING,
CLASS,
TEMP_CLASS,
TEMP_CLASS_START_DTE,
TEMP_CLASS_END_DTE,
CREDIT_SCORE,
ACCT_GROUP_NEXT,
ACCT_GROUP_NEXT_DTE,
COLM_START_DTE,
COLM_END_DTE,
COLM_END,
COLM_ACTION,
STOP_DELQ,
KK4_CLOSE_DTE,
FORCE_STOP_DTE,
USER_CHAR_1,
USER_CHAR_2,
USER_CHAR_3,
USER_CHAR_4,
USER_CHAR_5,
USER_DTE_1,
USER_DTE_2,
USER_DTE_3,
USER_DTE_4,
USER_DTE_5,
USER_AMT_1,
USER_AMT_2,
USER_AMT_3,
USER_AMT_4,
USER_AMT_5,
MNT_DT,
MNT_USER,
CURRENT_TIMESTAMP,
to_date('${BD_EXCH_DATE}', 'yyyy-MM-dd')
FROM ${SOURCE_TABLE_OWNER}.${SOURCE_TABLE}
WHERE DATA_EXCH_DATE = to_date('${BD_EXCH_DATE}', 'yyyy-MM-dd')
;

.export @LOAD_ROWCNT updatecnt;
