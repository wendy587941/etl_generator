-- SQL for table: EDW_GL_GLDPMR_PRESTAGE
-- Trinity SQL Script
/* TRANSFORM_DATA */

/* 1.Truncate 目的表 */
TRUNCATE TABLE ${TARGET_SCHEMA}.${TARGET_TABLE};

/* 
2. 抽取 正式區Stage DATA_EXCH_DATE='#資料交換期別#' 之資料
3. 遮罩後寫入驗證區Prestage 
*/
INSERT INTO ${TARGET_SCHEMA}.${TARGET_TABLE}
(
BRNO,
APNO,
SRNO,
CHKDG,
CURCD,
EVTCNT,
LNCNT,
INVSTA,
INVACT,
INVCHG,
INVAMT,
INVQTY,
INVERR,
INVDAY,
INVSOUR,
TELSTA,
TELCOD,
TELACT,
TELCHG,
TCODERR,
TCHKFG,
TCHKDAY,
TAMTERR,
TAPLDAY,
TCLSDAY,
THLDDAY,
TROPDAY,
TLTXDAY,
AVEBAL,
STPBAL,
LNBAL,
NDBQTY,
NCRQTY,
NTXDAY,
SELDAY,
BUYDAY,
LKINBR,
LWSNO,
LTXTNO,
TLRNO,
LTXDAY,
TRNCD,
EBACTNO_1,
EBACTNO_2,
EBACTNO_3,
EBACTNO_4,
EBACTNO_5,
EBACTNO_6,
EBACTNO_7,
EBACTNO_8,
INITCOST,
OAVEBAL,
SUMAMT,
AVGCOST,
SAFG,
SAERAMT,
HERITID,
HERITERR,
EBACTFG_1,
EBACTFG_2,
EBACTFG_3,
EBACTFG_4,
EBACTFG_5,
EBACTFG_6,
EBACTFG_7,
EBACTFG_8,
EBACTYR,
EBACTCT,
FILLER,
DATA_UPDATE_TIME,
DATA_EXCH_DATE
)
SELECT
BRNO,
APNO,
SDG.UFN_MASK_ACCT_SN(SRNO),
CHKDG,
CURCD,
EVTCNT,
LNCNT,
INVSTA,
SDG.UFN_MASK_ACCT(INVACT),
INVCHG,
INVAMT,
INVQTY,
INVERR,
INVDAY,
INVSOUR,
TELSTA,
TELCOD,
SDG.UFN_MASK_ACCT(TELACT),
TELCHG,
TCODERR,
TCHKFG,
TCHKDAY,
TAMTERR,
TAPLDAY,
TCLSDAY,
THLDDAY,
TROPDAY,
TLTXDAY,
AVEBAL,
STPBAL,
LNBAL,
NDBQTY,
NCRQTY,
NTXDAY,
SELDAY,
BUYDAY,
LKINBR,
LWSNO,
LTXTNO,
TLRNO,
LTXDAY,
TRNCD,
SDG.UFN_MASK_ACCT(EBACTNO_1),
SDG.UFN_MASK_ACCT(EBACTNO_2),
SDG.UFN_MASK_ACCT(EBACTNO_3),
SDG.UFN_MASK_ACCT(EBACTNO_4),
SDG.UFN_MASK_ACCT(EBACTNO_5),
SDG.UFN_MASK_ACCT(EBACTNO_6),
SDG.UFN_MASK_ACCT(EBACTNO_7),
SDG.UFN_MASK_ACCT(EBACTNO_8),
INITCOST,
OAVEBAL,
SUMAMT,
AVGCOST,
SAFG,
SAERAMT,
HERITID,
HERITERR,
EBACTFG_1,
EBACTFG_2,
EBACTFG_3,
EBACTFG_4,
EBACTFG_5,
EBACTFG_6,
EBACTFG_7,
EBACTFG_8,
EBACTYR,
EBACTCT,
FILLER,
CURRENT_TIMESTAMP,
to_date('${BD_EXCH_DATE}', 'yyyy-MM-dd')
FROM ${SOURCE_TABLE_OWNER}.${SOURCE_TABLE}
WHERE ${DATA_LIFE_BASE} = to_date('${BD_EXCH_DATE}', 'yyyy-MM-dd')
;

.export @LOAD_ROWCNT updatecnt;
