-- SQL for table: EDW_FC_FCTDTL
/* TRANSFORM_DATA */

-- 異動方式待補/待調整，以下目前為公版
/* 1. 刪除Base DATA_EXCH_DATE='#資料交換期別#' 之資料 */
DELETE FROM ${TARGET_SCHEMA}.${TARGET_TABLE} WHERE DATA_EXCH_DATE = TO_DATE('${BD_EXCH_DATE}', 'yyyy-MM-dd');

-- Trinity SQL Script
/* 2. 抽取Stage DATA_EXCH_DATE = '#資料交換期別#'之資料進行新增 */
INSERT INTO ${TARGET_SCHEMA}.${TARGET_TABLE}
(
ACTNO,
BRNO,
APNO,
SRNO,
CHKDG,
MBRNO,
MAPNO,
MSRNO,
MCHKDG,
MRERR,
ACTCLS,
ACTMVO,
ACTMVI,
CHGDP,
CTRVS,
CTRI,
ACTSTP,
CRTHLD,
BRHLD,
MRTGE,
ATERM,
PTERM,
MCLSCD,
INTRF,
GPACD,
REMAIND,
EXPCD,
ADVCD,
AUTIN,
PAYCD,
CURCD,
CHARCD,
IRTCD,
IRTID,
OPINTRT,
EXPER,
NEXPER,
LARGE,
CTNO,
TRNACT,
ELDCNT,
DWCNT,
PRDCD,
PRDCDD,
MATERM,
CIDAY,
ISDAY,
EDAY,
MODAY,
IRDAY,
IVDAY,
MCLSDAY,
AMCLSDAY,
ICIDAY,
PRIBAL,
CTBAL,
UDIAMT,
UDTAMT,
DIAMT,
DTAMT,
DPRAAMT,
CIAMT,
TUDIAMT,
TUDTAMT,
TDIAMT,
TDTAMT,
TCIAMT,
TUIAMT,
LBRNO,
LAPNO,
LSRNO,
LCHKDG,
NBRNO,
NAPNO,
NSRNO,
NCHKDG,
CRFLYM,
CRFLINT,
TCRLINT,
LINTRT,
CRFNYM,
CRFNINT,
TCRNINT,
NINTRT,
RXCNT,
XAPNO,
XCHARCD,
RXPCNT,
AXCNT,
LAPCNT,
LCHARCD,
LPCNT,
ASCNT,
ACHCNT,
AMGCNT,
ABHCNT,
STPBAL,
OVINTFG,
XTRNO,
BTPBAL,
BCIAMT,
BDWCNT,
HCODE,
TXDAY,
BTUDIA,
BTUDTA,
CRFINT,
CRFAMT,
BDIAMT,
BDTAMT,
BCRFLYM,
BCRLINT,
BLINTRT,
BCRFNYM,
BCRNINT,
BNINTRT,
DSCPT1,
DSCPT2,
DSCPT3,
PRTCD,
RBRNO,
OBRNO,
ODAY,
NTXDAY,
OPENBRNO,
EXPEREDAY,
PRDFG,
SBRNO,
IRTNO,
AOUNINO,
NIRTNO,
CASH,
UIDNO,
"199KIND",
DATA_UPDATE_TIME,
DATA_EXCH_DATE
)
SELECT
BRNO||APNO||SRNO||CHKDG,
BRNO,
APNO,
SRNO,
CHKDG,
MBRNO,
MAPNO,
MSRNO,
MCHKDG,
MRERR,
ACTCLS,
ACTMVO,
ACTMVI,
CHGDP,
CTRVS,
CTRI,
ACTSTP,
CRTHLD,
BRHLD,
MRTGE,
ATERM,
PTERM,
MCLSCD,
INTRF,
GPACD,
REMAIND,
EXPCD,
ADVCD,
AUTIN,
PAYCD,
CURCD,
CHARCD,
IRTCD,
IRTID,
OPINTRT,
EXPER,
NEXPER,
LARGE,
CTNO,
TRNACT,
ELDCNT,
DWCNT,
PRDCD,
PRDCDD,
MATERM,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(CIDAY), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(CIDAY))='0' THEN NULL ELSE CIDAY END) AS CIDAY,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(ISDAY), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(ISDAY))='0' THEN NULL ELSE ISDAY END) AS ISDAY,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(EDAY), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(EDAY))='0' THEN NULL ELSE EDAY END) AS EDAY,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(MODAY), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(MODAY))='0' THEN NULL ELSE MODAY END) AS MODAY,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(IRDAY), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(IRDAY))='0' THEN NULL ELSE IRDAY END) AS IRDAY,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(IVDAY), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(IVDAY))='0' THEN NULL ELSE IVDAY END) AS IVDAY,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(MCLSDAY), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(MCLSDAY))='0' THEN NULL ELSE MCLSDAY END) AS MCLSDAY,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(AMCLSDAY), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(AMCLSDAY))='0' THEN NULL ELSE AMCLSDAY END) AS AMCLSDAY,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(ICIDAY), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(ICIDAY))='0' THEN NULL ELSE ICIDAY END) AS ICIDAY,
PRIBAL,
CTBAL,
UDIAMT,
UDTAMT,
DIAMT,
DTAMT,
DPRAAMT,
CIAMT,
TUDIAMT,
TUDTAMT,
TDIAMT,
TDTAMT,
TCIAMT,
TUIAMT,
LBRNO,
LAPNO,
LSRNO,
LCHKDG,
NBRNO,
NAPNO,
NSRNO,
NCHKDG,
CRFLYM,
CRFLINT,
TCRLINT,
LINTRT,
CRFNYM,
CRFNINT,
TCRNINT,
NINTRT,
RXCNT,
XAPNO,
XCHARCD,
RXPCNT,
AXCNT,
LAPCNT,
LCHARCD,
LPCNT,
ASCNT,
ACHCNT,
AMGCNT,
ABHCNT,
STPBAL,
OVINTFG,
XTRNO,
BTPBAL,
BCIAMT,
BDWCNT,
HCODE,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(TXDAY), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(TXDAY))='0' THEN NULL ELSE TXDAY END) AS TXDAY,
BTUDIA,
BTUDTA,
CRFINT,
CRFAMT,
BDIAMT,
BDTAMT,
BCRFLYM,
BCRLINT,
BLINTRT,
BCRFNYM,
BCRNINT,
BNINTRT,
DSCPT1,
DSCPT2,
DSCPT3,
PRTCD,
RBRNO,
OBRNO,
ODAY,
NTXDAY,
OPENBRNO,
EXPEREDAY,
PRDFG,
SBRNO,
IRTNO,
AOUNINO,
NIRTNO,
CASH,
UIDNO,
"199KIND",
CURRENT_TIMESTAMP,
to_date('${BD_EXCH_DATE}', 'yyyy-MM-dd')
FROM ${SOURCE_TABLE_OWNER}.${SOURCE_TABLE}
WHERE DATA_EXCH_DATE = to_date('${BD_EXCH_DATE}', 'yyyy-MM-dd')
;

.export @LOAD_ROWCNT updatecnt;
