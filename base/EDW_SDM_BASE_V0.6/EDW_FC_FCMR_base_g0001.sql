-- SQL for table: EDW_FC_FCMR
/* TRANSFORM_DATA */

-- 異動方式待補/待調整，以下目前為公版
/* 1. 刪除Base DATA_EXCH_DATE='#資料交換期別#' 之資料 */
DELETE FROM ${TARGET_SCHEMA}.${TARGET_TABLE} WHERE DATA_EXCH_DATE = TO_DATE('${BD_EXCH_DATE}', 'yyyy-MM-dd');

-- Trinity SQL Script
/* 2. 抽取Stage DATA_EXCH_DATE = '#資料交換期別#'之資料進行新增 */
INSERT INTO ${TARGET_SCHEMA}.${TARGET_TABLE}
(
MACTNO,
MBRNO,
MAPNO,
MSRNO,
MCHKDG,
MO_ACTNO,
MO_BRNO,
MO_APNO,
MO_SRNO,
MO_CHKDG,
MI_ACTNO,
MI_BRNO,
MI_APNO,
MI_SRNO,
MI_CHKDG,
MRERR,
NBCD,
ACTSTP,
HIDENCD,
ACTSLP,
REMAIND,
ACTMVO,
ACTMVI,
MRTGE,
MAILCD,
ADVCD,
ACTCLS,
CHOP,
UNINO,
CORPNO,
PIDNO,
BCODE,
TAXCD,
RBRNO,
CHARCD,
PASWD,
PBCNT,
CTCNT,
MTCNT,
ASCNT,
PBVER,
PBPAGE,
PBCOL,
CTPAGE,
CTCOL,
OPDAY,
MODAY,
MIDAY,
LTXDAY,
BOOKDAY,
NTDPBAL,
NTWHBAL,
CHGAMT,
CHOPAMT,
CSDAY,
CEDAY,
LCURCD_1,
LCURCD_2,
LCURCD_3,
LCURCD_4,
LCURCD_5,
LCURCD_6,
LCURCD_7,
LCURCD_8,
LCURCD_9,
LCURCD_10,
LCURCD_11,
LCURCD_12,
LCURCD_13,
LCURCD_14,
LCURCD_15,
LCURCD_16,
LCURCD_17,
LCURCD_18,
LCURCD_19,
LCURCD_20,
LCURCD_21,
LCURCD_22,
LCURCD_23,
LCURCD_24,
LCURCD_25,
LCURCD_26,
LCURCD_27,
LCURCD_28,
LCURCD_29,
LCURCD_30,
IXPR_1,
IXPR_2,
IXPR_3,
IXPR_4,
IXPR_5,
IXPR_6,
IXPR_7,
IXPR_8,
IXPR_9,
IXPR_10,
IXPR_11,
IXPR_12,
IXPR_13,
IXPR_14,
IXPR_15,
IXPR_16,
IXPR_17,
IXPR_18,
IXPR_19,
IXPR_20,
IXPR_21,
IXPR_22,
IXPR_23,
IXPR_24,
IXPR_25,
IXPR_26,
IXPR_27,
IXPR_28,
IXPR_29,
IXPR_30,
RCSDAY,
RCEDAY,
RLCURCD_1,
RLCURCD_2,
RLCURCD_3,
RLCURCD_4,
RLCURCD_5,
RLCURCD_6,
RLCURCD_7,
RLCURCD_8,
RLCURCD_9,
RLCURCD_10,
RLCURCD_11,
RLCURCD_12,
RLCURCD_13,
RLCURCD_14,
RLCURCD_15,
RLCURCD_16,
RLCURCD_17,
RLCURCD_18,
RLCURCD_19,
RLCURCD_20,
RLCURCD_21,
RLCURCD_22,
RLCURCD_23,
RLCURCD_24,
RLCURCD_25,
RLCURCD_26,
RLCURCD_27,
RLCURCD_28,
RLCURCD_29,
RLCURCD_30,
RIXPR_1,
RIXPR_2,
RIXPR_3,
RIXPR_4,
RIXPR_5,
RIXPR_6,
RIXPR_7,
RIXPR_8,
RIXPR_9,
RIXPR_10,
RIXPR_11,
RIXPR_12,
RIXPR_13,
RIXPR_14,
RIXPR_15,
RIXPR_16,
RIXPR_17,
RIXPR_18,
RIXPR_19,
RIXPR_20,
RIXPR_21,
RIXPR_22,
RIXPR_23,
RIXPR_24,
RIXPR_25,
RIXPR_26,
RIXPR_27,
RIXPR_28,
RIXPR_29,
RIXPR_30,
PNBERR,
PNBDAY,
PNBSEQ,
PNBCNT,
PNBNSEQ,
PLNBDAY,
PBBAL_1,
PBBAL_2,
PBBAL_3,
PBBAL_4,
PBBAL_5,
PBBAL_6,
PBBAL_7,
PBBAL_8,
PBBAL_9,
PBBAL_10,
PBBAL_11,
PBBAL_12,
PBBAL_13,
PBBAL_14,
PBBAL_15,
PBBAL_16,
PBBAL_17,
PBBAL_18,
PBBAL_19,
PBBAL_20,
PBBAL_21,
PBBAL_22,
PBBAL_23,
PBBAL_24,
PBBAL_25,
PBBAL_26,
PBBAL_27,
PBBAL_28,
PBBAL_29,
PBBAL_30,
PBMTBAL_1,
PBMTBAL_2,
PBMTBAL_3,
PBMTBAL_4,
PBMTBAL_5,
PBMTBAL_6,
PBMTBAL_7,
PBMTBAL_8,
PBMTBAL_9,
PBMTBAL_10,
PBMTBAL_11,
PBMTBAL_12,
PBMTBAL_13,
PBMTBAL_14,
PBMTBAL_15,
PBMTBAL_16,
PBMTBAL_17,
PBMTBAL_18,
PBMTBAL_19,
PBMTBAL_20,
PBMTBAL_21,
PBMTBAL_22,
PBMTBAL_23,
PBMTBAL_24,
PBMTBAL_25,
PBMTBAL_26,
PBMTBAL_27,
PBMTBAL_28,
PBMTBAL_29,
PBMTBAL_30,
CNBERR,
CNBDAY,
CNBSEQ,
CNBCNT,
CNBNSEQ,
CLNBDAY,
ERPASSW,
RGBNO,
EIDERR,
PIDERR,
IRTCD,
CURFG,
NOIBK,
CBRNO,
OBRNO,
ODAY,
SLPBRNO1,
SLPDAY1,
SLPBRNO2,
SLPDAY2,
PRTCD,
NCHOPAMT,
SBRNO,
SLPFLG,
AOUNINO,
AGE,
UKIND,
UMARK,
UACNO,
Q60ERR,
UIDNO,
Q60ERDAY,
BK30DAY,
LSTDAY,
OBULN,
DATA_UPDATE_TIME,
DATA_EXCH_DATE
)
SELECT
MBRNO||MAPNO||MSRNO||MCHKDG,
MBRNO,
MAPNO,
MSRNO,
MCHKDG,
MO_BRNO||MO_APNO||MO_SRNO||MO_CHKDG,
MO_BRNO,
MO_APNO,
MO_SRNO,
MO_CHKDG,
MI_BRNO||MI_APNO||MI_SRNO||MI_CHKDG,
MI_BRNO,
MI_APNO,
MI_SRNO,
MI_CHKDG,
MRERR,
NBCD,
ACTSTP,
HIDENCD,
ACTSLP,
REMAIND,
ACTMVO,
ACTMVI,
MRTGE,
MAILCD,
ADVCD,
ACTCLS,
CHOP,
UNINO,
CORPNO,
PIDNO,
BCODE,
TAXCD,
RBRNO,
CHARCD,
PASWD,
PBCNT,
CTCNT,
MTCNT,
ASCNT,
PBVER,
PBPAGE,
PBCOL,
CTPAGE,
CTCOL,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(OPDAY), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(OPDAY))='0' THEN NULL ELSE OPDAY END) AS OPDAY,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(MODAY), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(MODAY))='0' THEN NULL ELSE MODAY END) AS MODAY,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(MIDAY), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(MIDAY))='0' THEN NULL ELSE MIDAY END) AS MIDAY,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(LTXDAY), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(LTXDAY))='0' THEN NULL ELSE LTXDAY END) AS LTXDAY,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(BOOKDAY), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(BOOKDAY))='0' THEN NULL ELSE BOOKDAY END) AS BOOKDAY,
NTDPBAL,
NTWHBAL,
CHGAMT,
CHOPAMT,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(CSDAY), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(CSDAY))='0' THEN NULL ELSE CSDAY END) AS CSDAY,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(CEDAY), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(CEDAY))='0' THEN NULL ELSE CEDAY END) AS CEDAY,
LCURCD_1,
LCURCD_2,
LCURCD_3,
LCURCD_4,
LCURCD_5,
LCURCD_6,
LCURCD_7,
LCURCD_8,
LCURCD_9,
LCURCD_10,
LCURCD_11,
LCURCD_12,
LCURCD_13,
LCURCD_14,
LCURCD_15,
LCURCD_16,
LCURCD_17,
LCURCD_18,
LCURCD_19,
LCURCD_20,
LCURCD_21,
LCURCD_22,
LCURCD_23,
LCURCD_24,
LCURCD_25,
LCURCD_26,
LCURCD_27,
LCURCD_28,
LCURCD_29,
LCURCD_30,
IXPR_1,
IXPR_2,
IXPR_3,
IXPR_4,
IXPR_5,
IXPR_6,
IXPR_7,
IXPR_8,
IXPR_9,
IXPR_10,
IXPR_11,
IXPR_12,
IXPR_13,
IXPR_14,
IXPR_15,
IXPR_16,
IXPR_17,
IXPR_18,
IXPR_19,
IXPR_20,
IXPR_21,
IXPR_22,
IXPR_23,
IXPR_24,
IXPR_25,
IXPR_26,
IXPR_27,
IXPR_28,
IXPR_29,
IXPR_30,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(RCSDAY), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(RCSDAY))='0' THEN NULL ELSE RCSDAY END) AS RCSDAY,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(RCEDAY), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(RCEDAY))='0' THEN NULL ELSE RCEDAY END) AS RCEDAY,
RLCURCD_1,
RLCURCD_2,
RLCURCD_3,
RLCURCD_4,
RLCURCD_5,
RLCURCD_6,
RLCURCD_7,
RLCURCD_8,
RLCURCD_9,
RLCURCD_10,
RLCURCD_11,
RLCURCD_12,
RLCURCD_13,
RLCURCD_14,
RLCURCD_15,
RLCURCD_16,
RLCURCD_17,
RLCURCD_18,
RLCURCD_19,
RLCURCD_20,
RLCURCD_21,
RLCURCD_22,
RLCURCD_23,
RLCURCD_24,
RLCURCD_25,
RLCURCD_26,
RLCURCD_27,
RLCURCD_28,
RLCURCD_29,
RLCURCD_30,
RIXPR_1,
RIXPR_2,
RIXPR_3,
RIXPR_4,
RIXPR_5,
RIXPR_6,
RIXPR_7,
RIXPR_8,
RIXPR_9,
RIXPR_10,
RIXPR_11,
RIXPR_12,
RIXPR_13,
RIXPR_14,
RIXPR_15,
RIXPR_16,
RIXPR_17,
RIXPR_18,
RIXPR_19,
RIXPR_20,
RIXPR_21,
RIXPR_22,
RIXPR_23,
RIXPR_24,
RIXPR_25,
RIXPR_26,
RIXPR_27,
RIXPR_28,
RIXPR_29,
RIXPR_30,
PNBERR,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(PNBDAY), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(PNBDAY))='0' THEN NULL ELSE PNBDAY END) AS PNBDAY,
PNBSEQ,
PNBCNT,
PNBNSEQ,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(PLNBDAY), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(PLNBDAY))='0' THEN NULL ELSE PLNBDAY END) AS PLNBDAY,
PBBAL_1,
PBBAL_2,
PBBAL_3,
PBBAL_4,
PBBAL_5,
PBBAL_6,
PBBAL_7,
PBBAL_8,
PBBAL_9,
PBBAL_10,
PBBAL_11,
PBBAL_12,
PBBAL_13,
PBBAL_14,
PBBAL_15,
PBBAL_16,
PBBAL_17,
PBBAL_18,
PBBAL_19,
PBBAL_20,
PBBAL_21,
PBBAL_22,
PBBAL_23,
PBBAL_24,
PBBAL_25,
PBBAL_26,
PBBAL_27,
PBBAL_28,
PBBAL_29,
PBBAL_30,
PBMTBAL_1,
PBMTBAL_2,
PBMTBAL_3,
PBMTBAL_4,
PBMTBAL_5,
PBMTBAL_6,
PBMTBAL_7,
PBMTBAL_8,
PBMTBAL_9,
PBMTBAL_10,
PBMTBAL_11,
PBMTBAL_12,
PBMTBAL_13,
PBMTBAL_14,
PBMTBAL_15,
PBMTBAL_16,
PBMTBAL_17,
PBMTBAL_18,
PBMTBAL_19,
PBMTBAL_20,
PBMTBAL_21,
PBMTBAL_22,
PBMTBAL_23,
PBMTBAL_24,
PBMTBAL_25,
PBMTBAL_26,
PBMTBAL_27,
PBMTBAL_28,
PBMTBAL_29,
PBMTBAL_30,
CNBERR,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(CNBDAY), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(CNBDAY))='0' THEN NULL ELSE CNBDAY END) AS CNBDAY,
CNBSEQ,
CNBCNT,
CNBNSEQ,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(CLNBDAY), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(CLNBDAY))='0' THEN NULL ELSE CLNBDAY END) AS CLNBDAY,
ERPASSW,
RGBNO,
EIDERR,
PIDERR,
IRTCD,
CURFG,
NOIBK,
CBRNO,
OBRNO,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(ODAY), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(ODAY))='0' THEN NULL ELSE ODAY END) AS ODAY,
SLPBRNO1,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(SLPDAY1), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(SLPDAY1))='0' THEN NULL ELSE SLPDAY1 END) AS SLPDAY1,
SLPBRNO2,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(SLPDAY2), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(SLPDAY2))='0' THEN NULL ELSE SLPDAY2 END) AS SLPDAY2,
PRTCD,
NCHOPAMT,
SBRNO,
SLPFLG,
AOUNINO,
AGE,
UKIND,
UMARK,
UACNO,
Q60ERR,
UIDNO,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(Q60ERDAY), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(Q60ERDAY))='0' THEN NULL ELSE Q60ERDAY END) AS Q60ERDAY,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(BK30DAY), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(BK30DAY))='0' THEN NULL ELSE BK30DAY END) AS BK30DAY,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(LSTDAY), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(LSTDAY))='0' THEN NULL ELSE LSTDAY END) AS LSTDAY,
OBULN,
CURRENT_TIMESTAMP,
to_date('${BD_EXCH_DATE}', 'yyyy-MM-dd')
FROM ${SOURCE_TABLE_OWNER}.${SOURCE_TABLE}
WHERE DATA_EXCH_DATE = to_date('${BD_EXCH_DATE}', 'yyyy-MM-dd')
;

.export @LOAD_ROWCNT updatecnt;
