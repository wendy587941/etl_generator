-- SQL for table: EDW_INBK_S01
/* TRANSFORM_DATA */

-- 異動方式待補/待調整，以下目前為公版
/* 1. 刪除Base DATA_EXCH_DATE='#資料交換期別#' 之資料 */
DELETE FROM ${TARGET_SCHEMA}.${TARGET_TABLE} WHERE DATA_EXCH_DATE = TO_DATE('${BD_EXCH_DATE}', 'yyyy-MM-dd');

-- Trinity SQL Script
/* 2. 抽取Stage DATA_EXCH_DATE = '#資料交換期別#'之資料進行新增 */
INSERT INTO ${TARGET_SCHEMA}.${TARGET_TABLE}
(
MSGKIND,
BKNO,
DD,
STAN,
MSGFLOW,
FILLER1,
UPDFLG,
PENDING,
TMOUT,
BUSDT,
ERRNO,
RMHC,
CDMODE,
FISCDT,
BRNO,
TXDT,
TXTM,
DBK,
DBR,
SBK,
SBR,
TXAMT,
RTNCD,
MT,
PC,
FIL1,
FIL2,
LOGNO,
ACTNO,
RC_1,
RC_2,
RC_3,
RC_4,
ER_1,
ER_2,
ER_3,
ER_4,
DATA,
CARDNO,
ACTKIND,
VWD,
COMMDATA,
RECNO_1,
RECNO_2,
RECNO_3,
RECNO_4,
RECNO_5,
DATA_UPDATE_TIME,
DATA_EXCH_DATE
)
SELECT
MSGKIND,
BKNO,
DD,
STAN,
MSGFLOW,
FILLER1,
UPDFLG,
PENDING,
TMOUT,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(BUSDT), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(BUSDT))='0' THEN NULL ELSE BUSDT END) AS BUSDT,
ERRNO,
RMHC,
CDMODE,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(FISCDT), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(FISCDT))='0' THEN NULL ELSE FISCDT END) AS FISCDT,
BRNO,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(TXDT), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(TXDT))='0' THEN NULL ELSE TXDT END) AS TXDT,
SDG.UFN_NORM_DATE(CASE WHEN NVL(TRIM(TXDT)||' '||TRIM(TXTM), '')='' THEN NULL WHEN SDG.UFN_ADDATECHECK_DATE(TRIM(TXDT)||' '||TRIM(TXTM))='0' THEN NULL ELSE TRIM(TXDT)||' '||TRIM(TXTM) END) AS TXTM,
DBK,
DBR,
SBK,
SBR,
TXAMT,
RTNCD,
MT,
PC,
FIL1,
FIL2,
LOGNO,
ACTNO,
RC_1,
RC_2,
RC_3,
RC_4,
ER_1,
ER_2,
ER_3,
ER_4,
DATA,
CARDNO,
ACTKIND,
VWD,
COMMDATA,
RECNO_1,
RECNO_2,
RECNO_3,
RECNO_4,
RECNO_5,
CURRENT_TIMESTAMP,
to_date('${BD_EXCH_DATE}', 'yyyy-MM-dd')
FROM ${SOURCE_TABLE_OWNER}.${SOURCE_TABLE}
WHERE DATA_EXCH_DATE = to_date('${BD_EXCH_DATE}', 'yyyy-MM-dd')
;

.export @LOAD_ROWCNT updatecnt;
